$(document).ready(function(){function k(b){for(var c=0,a=0;a<b.length;a++)b[a].length>c&&(c=b[a].length);c=5>c?5:c;f="";for(b=0;b<c;b++)f+="_"}function j(){a=[];e=[];var b="";paragraph=activityContent.paragraph;var c=ucanMarkupToHtml(paragraph),d=/\[([^\]])+\]/g;a=c.match(d);k(a);e=c.match(d);e=shuffle(e);c=c.replace(d,'<span class="blank"><span>'+f+"</span></span>");$("#paragraph-container").append($(c));for(i=0;i<a.length;i++)b+='<span class="word">'+e[i].substring(1,e[i].length-1).toLowerCase()+
"</span> ";$("#word-list").append($(b));$(".text:first").focus();$("#word-list span").draggable({revert:"invalid",helper:"clone"});$("#paragraph-container .blank").droppable({accept:"#word-list span, #paragraph-container .word ",over:function(){$(this).addClass("blank-over")},out:function(){$(this).removeClass("blank-over")},drop:function(b,a){playSound(Ucan.Resource.Audio.getClickedSound());$(this).removeClass("blank-over");a.draggable.parent().hasClass("blank")&&$(this).hasClass("blank")&&(a.draggable.parent().append($(this).children()),
$(this).append(a.draggable.css({color:"#f5770f"})));!a.draggable.parent().hasClass("blank")&&$(this).hasClass("blank")&&($(this).children().hasClass("word")&&a.draggable.parent().append($(this).children().css({color:"black"})),$(this).children().remove(),$(this).append(a.draggable.css({color:"#f5770f"})));$(this).fadeOut(200).fadeIn(500)}});$("#word-list").droppable({accept:"#paragraph-container .word",drop:function(a,b){playSound(Ucan.Resource.Audio.getClickedSound());b.draggable.parent().append("<span>"+
f+"</span>");$(this).append(" ").append(b.draggable.css({color:"black"}))}})}var g=!0,h=!1,a=[],f,e=[];j();$("#show-answer").click(function(){var b=0;$("#paragraph-container .blank").each(function(){var c=a[b].substring(1,a[b].length-1);$(this).text(c).css({color:"#f5770f","font-weight":"bold"});b++});$("#paragraph-container .blank").fadeOut(500).fadeIn(500)});var d=0;$("#loadResult").click(function(){if(g){g=!1;$(".ui-draggable").draggable("disable");$(".cp-jplayer").jPlayer("stop");playSound(Ucan.Resource.Audio.getShowResultSound());
var b=d=0;$("#paragraph-container .blank").each(function(){$(this).children().text()==a[b].substring(1,a[b].length-1).toLowerCase()?(d++,insertTrueFalseIconAfter(!0,this)):insertTrueFalseIconAfter(!1,this);b++});$(".true-icon").css({margin:"-10px 5px 0px 1px","box-shadow":"none",border:"none",width:"18px",height:"18px"});$(".false-icon").css({margin:"-5px 5px 0px 1px","box-shadow":"none",border:"none",width:"18px",height:"18px"});$(".true-icon, .false-icon").ucanAnimateTrueFalseIcon();$("#num-of-correct-answers-result").text(d+
"/"+a.length);score=Math.floor(100*(d/a.length));$("#score-text").text(score);$("#show-result").show("slide",{direction:"left"},Ucan.Constants.getShowResultSpeed());h=!0}});$("#redo").click(function(){h&&(h=!1,$("#show-result").hide("slide",{direction:"left"},Ucan.Constants.getHideResultSpeed(),function(){$("#paragraph-container").html("");$("#word-list").html("");g=!0;j()}))})});