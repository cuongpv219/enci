$(document).ready(function(){function q(a){for(var d=0,e=0;e<a.length;e++){var f=htmlEncode(a[e]),f=f.length/(f.match("/")?f.match("/").length+1:1);f>d&&(d=f)}return 10>d?"shortest":20>d?"short":30>d?"long":"longest"}function r(){for(var a=0;a<f.length;a++){for(var d=f[a],e="",g=0;g<d.length;g++){var c=d[g],e=e+('<div class="question-wrapper" data-group="'+a+'" data-index="'+g+'" data-type="'+c.type+'" data-answer="'+(6==c.type?"0":"-1")+'">');switch(c.type){case "1":for(var b=c.question.replace("[]",
'<span class="blank">__________</span>'),e=e+('<div class="multiplechoice-ask">'+b+"</div>"),b=0;b<c.choiceArr.length;b++)e+='<div class="multiplechoice-choice-container" data-index="'+b+'"><div class="multiplechoice-choice global-choice-square"></div><span class="multiplechoice-choice-text">'+c.choiceArr[b]+"</span></div>";break;case "6":e+='<div class="checklist-ask">'+c.question+"</div>";for(b=0;b<c.choiceArr.length;b++)e+='<div class="checklist-choice-container" data-index="'+b+'"><div class="checklist-choice global-choice-square"></div><span class="checklist-choice-text">'+
c.choiceArr[b]+"</span></div>";break;case "7":e+='<div class="marktrueanswer-order">1.</div><div class="marktrueanswer-choices">';for(b=0;b<c.choiceArr.length;b++)e+='<div class="marktrueanswer-choice marktrueanswer-choice-'+c.choiceClass+' unselected" data-index="'+b+'">'+c.choiceArr[b]+"</div>";e+='</div><div class="marktrueanswer-sentence">'+(c.sentence?c.sentence:"")+"</div>";break;case "2":for(var h=shuffle(c.wordArr.slice(0)),e=e+'<ul class="sortword-list sortable">',b=0;b<h.length;b++)e+='<li class="sortword-word">'+
h[b]+"</li>";e+='</ul><div class="sortword-icon-placeholder"></div>';break;case "3":e+=c.paragraphHtml;break;case "4":e+=c.paragraphHtml;break;case "5":e+='<div class="completetextwithgivenword-wordlist" data-group="'+a+'" data-index="'+g+'">';h=shuffle(c.answerStrList.slice(0));for(b=0;b<h.length;b++)e+='<span class="completetextwithgivenword-word">'+h[b]+"</span>";e+='</div><div class="activity-guide"><div class="activity-guide-wrap"><img alt="arrow" src="/shark/public/themes/blueocean/img/down-arrow-pointer.png"><div class="activity-guide-text">'+
multiLangSystem.activity_guide_text+'</div></div></div><div class="completetextwithgivenword-paragraph">';e+=c.paragraphHtml;e+="</div>"}c.explanation&&(e+='<div class="question-explanation"> * '+c.explanation+"</div>");e+="</div>"}$("#group-question_"+a).append(e);$(".group-container").each(function(){var a=1;$(this).find('.question-wrapper[data-type="7"]').each(function(){$(this).children(".marktrueanswer-order").text(a+".");a++})})}$(".multiplechoice-choice-container").click(function(){m&&($(this).siblings(".multiplechoice-choice-container").children(".multiplechoice-choice").removeClass("checked"),
$(this).children(".multiplechoice-choice").addClass("checked"),$(this).siblings(".multiplechoice-ask").children(".blank").html($(this).text()).addClass("checked-blank"),$(this).parent().attr("data-answer",$(this).attr("data-index")))});$(".checklist-choice-container").click(function(){if(m){$(this).children(".checklist-choice").hasClass("checked")?$(this).children(".checklist-choice").removeClass("checked"):$(this).children(".checklist-choice").addClass("checked");var a=0;$(this).parent().find(".checklist-choice").each(function(){$(this).hasClass("checked")&&
(a+=Math.pow(2,parseInt($(this).parent().attr("data-index"))))});$(this).parent().attr("data-answer",a)}});$(".marktrueanswer-choice").click(function(){m&&($(this).siblings(".marktrueanswer-choice").removeClass("selected").addClass("unselected"),$(this).removeClass("unselected").addClass("selected"),$(this).parent().parent().attr("data-answer",$(this).attr("data-index")))});$(".sortable").sortable({opacity:0.8,revert:!0,cursor:"move",start:function(a,b){b.helper.css("width",b.helper.width()+1+"px")}});
$(".choosecorrectanswer-choice").click(function(){!1!=m&&($(this).parent().attr("data-answer",$(this).attr("data-index")),$(this).siblings().animate({opacity:"0.3"},500).animate({color:"#8c8c8c",opacity:"1"},500).removeClass("chosen"),$(this).animate({opacity:"0.3"},500).animate({color:"#f5770f",opacity:"1"},500).addClass("chosen"))});$(".completetextwithgivenword-wordlist span").draggable({revert:"invalid",helper:"clone"});$(".completetextwithgivenword-blank").droppable({accept:".completetextwithgivenword-word",
over:function(a,b){$(this).attr("data-group")==b.draggable.parent().attr("data-group")&&$(this).attr("data-index")==b.draggable.parent().attr("data-index")&&$(this).addClass("completetextwithgivenword-blank-over")},out:function(){$(this).removeClass("completetextwithgivenword-blank-over")},drop:function(a,b){$(this).removeClass("completetextwithgivenword-blank-over");$(this).attr("data-group")==b.draggable.parent().attr("data-group")&&$(this).attr("data-index")==b.draggable.parent().attr("data-index")&&
(b.draggable.parent().hasClass("completetextwithgivenword-blank")&&(b.draggable.parent().append($(this).children()),$(this).append(b.draggable.css({color:"#f5770f"}))),b.draggable.parent().hasClass("completetextwithgivenword-blank")||($(this).children().hasClass("completetextwithgivenword-word")&&b.draggable.parent().append($(this).children().css("color","")),$(this).children().remove(),$(this).append(b.draggable.css({color:"#f5770f"}))),$(this).fadeOut(200).fadeIn(500))}});$(".completetextwithgivenword-wordlist").droppable({accept:".completetextwithgivenword-blank .completetextwithgivenword-word",
drop:function(a,b){$(this).attr("data-group")==b.draggable.parent().attr("data-group")&&$(this).attr("data-index")==b.draggable.parent().attr("data-index")&&(b.draggable.parent().append('<span class="underscore">'+f[$(this).attr("data-group")][$(this).attr("data-index")].underscoreStr+"</span>"),$(this).append(" ").append(b.draggable.css({color:""})))}})}multiLangSystem.activity_guide_text="vi"==defaultLanguage?"K\u00e9o t\u1eeb v\u00e0o ch\u1ed7 tr\u1ed1ng ph\u00f9 h\u1ee3p":"Drag words to the appropriate blanks";
for(var m=!0,n=!1,s=activityContent.group.length,k=0,f=[],o=0;o<s;o++){var b=JSON.parse(activityContent.group[o].question);if("0"==b.type)questionArr=[],f[f.length]=questionArr;else{switch(b.type){case "1":k++;for(var c=b.choices.split("||"),d=[],g=-1,a=0;a<c.length;a++)d[a]=$.trim(c[a]),0==d[a].indexOf("#")&&(g=a,d[a]=d[a].substring(1));b.choiceArr=d;b.answer=g;break;case "6":k++;c=b.choices.split("||");d=[];for(a=g=0;a<c.length;a++)d[a]=$.trim(c[a]),0==d[a].indexOf("#")&&(g+=Math.pow(2,a),d[a]=
d[a].substring(1));b.choiceArr=d;b.answer=g;break;case "7":k++;for(var c=b.choices.split("||"),d=[],g=-1,h=1,a=0;a<c.length;a++)d[a]=$.trim(c[a]),0==d[a].indexOf("#")&&(g=a,d[a]=d[a].substring(1)),h=d[a].length>h?d[a].length:h;a=3>h?"shortest":6>h?"short":9>h?"long":"longest";b.choiceArr=d;b.answer=g;b.choiceClass=a;break;case "2":k++;c=b.words.split("||");h=[];for(a=0;a<c.length;a++)h[a]=$.trim(c[a]).toLowerCase();b.wordArr=h;b.answer=h.join(" ");break;case "3":for(var h=b.paragraph,c=/\[([^\]])+\]/g,
j=[],l=h.match(c),a=0;a<l.length;a++){for(var p={},c=l[a].substring(1,l[a].length-1).split("||"),d=[],g=-1,i=0;i<c.length;i++)d[i]=$.trim(c[i]),0==d[i].indexOf("#")&&(g=i,d[i]=d[i].substring(1));p.answer=g;p.choiceArr=d;j[j.length]=p}c=/\[([^\]])+\]/;for(a=0;a<j.length;a++){g='<span class="choosecorrectanswer-choices-container" data-group="'+(f.length-1)+'" data-index="'+f[f.length-1].length+'" data-order="'+a+'">';for(i=0;i<j[a].choiceArr.length;i++)g+=(0==i?"":" / ")+'<span class="choosecorrectanswer-choice" data-index="'+
i+'">'+j[a].choiceArr[i]+"</span>";g+="</span>";h=h.replace(c,g)}b.paragraphHtml=h;b.choiceList=j;k+=j.length;break;case "4":h=b.paragraph;c=/\[([^\]])+\]/g;j=[];d=[];g=h.match(c);i="";if(g){i=q(g);for(a=0;a<g.length;a++)l=g[a].substring(1,g[a].length-1),c=l.split("/"),j[j.length]=c,d[d.length]=l}c=/\[([^\]])+\]/;for(a=0;a<j.length;a++)g='<input type="text" class="completetext-blank completetext-blank-'+i+'" data-group="'+(f.length-1)+'" data-index="'+f[f.length-1].length+'" data-order="'+a+'">',
h=h.replace(c,g);b.paragraphHtml=h;b.answersList=j;b.answerStrList=d;k+=j.length;break;case "5":h=b.paragraph;c=/\[([^\]])+\]/g;d=[];g=h.match(c);i=q(g);j="shortest"==i?"_______":"short"==i?"______________":"long"==i?"_____________________":"____________________________";for(a=0;a<g.length;a++)l=g[a].substring(1,g[a].length-1),d[d.length]=l;c=/\[([^\]])+\]/;for(a=0;a<d.length;a++)g='<span class="completetextwithgivenword-blank" data-group="'+(f.length-1)+'" data-index="'+f[f.length-1].length+'" data-order="'+
a+'"><span class="underscore">'+j+"</span></span>",h=h.replace(c,g);b.paragraphHtml=h;b.answerStrList=d;b.underscoreStr=j;k+=d.length}f[f.length-1][f[f.length-1].length]=b}}r();$("#show-answer").click(function(){$(".checked").removeClass("checked");$(".marktrueanswer-choice").addClass("unselected").removeClass("selected");$(".question-wrapper").each(function(){switch($(this).attr("data-type")){case "1":var a=f[$(this).attr("data-group")][$(this).attr("data-index")].answer;$(this).children('.multiplechoice-choice-container[data-index="'+
a+'"]').children(".multiplechoice-choice").addClass("checked");$(this).children(".multiplechoice-ask").children(".blank").html(f[$(this).attr("data-group")][$(this).attr("data-index")].choiceArr[a]).addClass("checked-blank");break;case "6":for(var a=f[$(this).attr("data-group")][$(this).attr("data-index")].answer,b=0;b<f[$(this).attr("data-group")][$(this).attr("data-index")].choiceArr.length;b++)a&1&&$(this).children('.checklist-choice-container[data-index="'+b+'"]').children(".checklist-choice").addClass("checked"),
a=Math.floor(a/2);break;case "7":a=f[$(this).attr("data-group")][$(this).attr("data-index")].answer;$(this).children(".marktrueanswer-choices").children('.marktrueanswer-choice[data-index="'+a+'"]').addClass("selected").removeClass("unselected");break;case "6":case "2":var c=0,d=f[$(this).attr("data-group")][$(this).attr("data-index")].wordArr;$(this).children(".sortword-list").children(".sortword-word").each(function(){$(this).text(d[c++])})}});$(".choosecorrectanswer-choice").animate({opacity:"0.3"},
500).animate({color:"#8c8c8c",opacity:"1"},500);$(".choosecorrectanswer-choices-container").each(function(){var a=f[$(this).attr("data-group")][$(this).attr("data-index")].choiceList[$(this).attr("data-order")].answer;$(this).children('.choosecorrectanswer-choice[data-index="'+a+'"]').animate({opacity:"0.3"},500).animate({color:"#f5770f",opacity:"1"},500)});$(".completetext-blank").each(function(){$(this).val(htmlEncode(f[$(this).attr("data-group")][$(this).attr("data-index")].answerStrList[$(this).attr("data-order")]))});
$(".completetextwithgivenword-blank").each(function(){$(this).children().text(f[$(this).attr("data-group")][$(this).attr("data-index")].answerStrList[$(this).attr("data-order")])});$(".completetextwithgivenword-blank").css({color:"#f5770f"}).fadeOut(500).fadeIn(500);$(".checked").fadeOut(500).fadeIn(500);$(".marktrueanswer-choices .selected").fadeOut(500).fadeIn(500);$(".sortable").fadeOut(500).fadeIn(500);$(".question-explanation").show()});$("#loadResult").click(function(){if(m){$(".cp-jplayer").jPlayer("stop");
$(".sortable").sortable("disable");m=!1;var a=0;$(".question-wrapper").each(function(){switch($(this).attr("data-type")){case "1":f[$(this).attr("data-group")][$(this).attr("data-index")].answer==$(this).attr("data-answer")?(a++,insertTrueFalseIcon(!0,$(this).children(".multiplechoice-ask"))):insertTrueFalseIcon(!1,$(this).children(".multiplechoice-ask"));$(this).children(".multiplechoice-ask").children(".true-icon,.false-icon").addClass("multiplechoice-icon");break;case "6":f[$(this).attr("data-group")][$(this).attr("data-index")].answer==
$(this).attr("data-answer")?(a++,insertTrueFalseIcon(!0,$(this).children(".checklist-ask"))):insertTrueFalseIcon(!1,$(this).children(".checklist-ask"));$(this).children(".checklist-ask").children(".true-icon,.false-icon").addClass("checklist-icon");break;case "7":f[$(this).attr("data-group")][$(this).attr("data-index")].answer==$(this).attr("data-answer")?(a++,insertTrueFalseIconAfter(!0,$(this).children(".marktrueanswer-sentence"))):insertTrueFalseIconAfter(!1,$(this).children(".marktrueanswer-sentence"));
$(this).children(".true-icon,.false-icon").addClass("marktrueanswer-icon");break;case "2":var b="";$(this).children(".sortword-list").children(".sortword-word").each(function(){b+=" "+$(this).text()});$.trim(b)==htmlEncode(f[$(this).attr("data-group")][$(this).attr("data-index")].answer)?(a++,insertTrueFalseIconAfter(!0,$(this).children(".sortword-list"))):insertTrueFalseIconAfter(!1,$(this).children(".sortword-list"));$(this).children(".true-icon,.false-icon").addClass("sortword-icon")}});$(".choosecorrectanswer-choices-container").each(function(){f[$(this).attr("data-group")][$(this).attr("data-index")].choiceList[$(this).attr("data-order")].answer==
$(this).attr("data-answer")?(a++,insertTrueFalseIcon(!0,$(this))):insertTrueFalseIcon(!1,$(this))});$(".completetext-blank").each(function(){for(var b=!1,c=f[$(this).attr("data-group")][$(this).attr("data-index")].answersList[$(this).attr("data-order")],d=0;d<c.length;d++)if(isEqualString($(this).val(),htmlEncode(c[d]))){b=!0;break}b?(a++,insertTrueFalseIconAfter(!0,$(this))):insertTrueFalseIconAfter(!1,$(this))});$(".completetextwithgivenword-blank").each(function(){isEqualString(f[$(this).attr("data-group")][$(this).attr("data-index")].answerStrList[$(this).attr("data-order")],
$(this).text())?(a++,insertTrueFalseIconAfter(!0,$(this))):insertTrueFalseIconAfter(!1,$(this))});$(".true-icon, .false-icon").ucanAnimateTrueFalseIcon();$("#num-of-correct-answers-result").text(a+"/"+k);score=Math.floor(100*(a/k));$("#score-text").text(score);$("#show-result").show("slide",{direction:"left"},Ucan.Constants.getShowResultSpeed());n=!0}});$("#redo").click(function(){n&&(n=!1,$("#show-result").hide("slide",{direction:"left"},Ucan.Constants.getHideResultSpeed(),function(){m=!0;$(".question-explanation").hide();
$(".question-wrapper").remove();r()}))})});