$(document).ready(function(){displayActivity();"en"==defaultLanguage?(multiLangSystem.title_correct_many_times=" in row",multiLangSystem.title_level="Level "):(multiLangSystem.title_correct_many_times=" c\u00e2u li\u00ean ti\u1ebfp ",multiLangSystem.title_level="C\u1ea5p \u0111\u1ed9 ")});var audioSrc=baseUrl+"/audio/",groups=activityContent.word_groups,words,level=1,score=0,timeLeft=20,correctTimes=0,wrongTimes=0,totalCorrect=0,curWordSet,key,intervalID,gameOver=!1,msgList=[],hasMsg=!1,startTime;
function displayActivity(){$("#intro-scene").prepend('<div id="btn-start" class="global-button-orange-3">'+multiLangSystem.button_play_now+"</div>");$("#intro-scene").prepend('<img src="'+baseUrl+'/themes/blueocean/img/Game-BlackSheep-Intro.png" alt="Introduction" />');$("#btn-start").click(function(){$("#game-audio-intro").remove();$("#game-audio-intro").remove();$("#activity-container").append('<div class="submitDiv global-submit-div"><div id="btn-endgame" class="global-button-green-1">'+multiLangSystem.button_finish+
"</div></div>");$("#main-scene").fadeIn(500,function(){words=initData();startTime=(new Date).getTime();displayNewWordSet()});$("#intro-scene").hide();$("#intro-scene").next(".submitDiv").hide();$("#btn-endgame").click(function(){endGame()})});$("#game-over .play-again").click(function(){playAgain()})}
function displayNewWordSet(){if(!gameOver&&!hasMsg){curWordSet=getWordSet(level);key=curWordSet[0];shuffle(curWordSet);0==$("#game-board .unfinished").size()?$("#game-board").append('<div class="unfinished"><div class="word-group-wrapper"></div></div>'):$("#game-board .unfinished .word-group-wrapper").stop(!0,!0).html("").fadeOut(500);$("#game-board .unfinished").css({bottom:function(){return 50*$("#game-board .finished").size()+14}});for(var a=0;a<curWordSet.length;a++)$("#game-board .unfinished .word-group-wrapper").append('<div class="unselected" data-value="'+
htmlEncode(curWordSet[a])+'">'+curWordSet[a]+"</div>");$("#game-board .unfinished .word-group-wrapper").stop(!0,!0).fadeIn(500);clearInterval(intervalID);runTimer();$(".unfinished .word-group-wrapper .unselected").click(function(){var a=$(this).attr("data-value");compareTwoString(a,htmlEncode(key))?(increaseScore(),totalCorrect++,correctTimes++,0!=correctTimes&&0==correctTimes%5&&(addPlusMark(),hasMsg=!0,a={type:1},a.content=correctTimes+multiLangSystem.title_correct_many_times+"!"+20*correctTimes,
msgList.push(a)),0==totalCorrect%5&&10>level&&(level++,level=9<level?10:level,hasMsg=!0,a={type:2},a.content=multiLangSystem.title_level+level,msgList.push(a)),hasMsg?displayMessage():displayNewWordSet()):(playSound(audioSrc+"incorrect.mp3"),frozenWordSet($(this)));rebuildResult()})}}var msgOffset=0;
function displayMessage(){if(0==msgList.length)$("#game-board .unfinished").children().show();else{$("#game-board .unfinished").children().hide();switch(msgList[msgOffset].type){case 1:playSound(audioSrc+"plusmark.mp3");break;case 2:playSound(audioSrc+"levelup.mp3")}var a=msgList[msgOffset].content;$("#game-board .unfinished").append('<h1 id="msg-board">'+a+"</h1>");$("h1#msg-board").css({width:"100%","text-align":"center","max-height":"38px",bottom:"2px","background-color":"white",position:"absolute",
color:"#fca302","font-size":"26px","font-weight":"bold",display:"none"}).fadeIn(1E3).fadeOut(1E3,function(){$("h1#msg-board").remove();msgOffset==msgList.length-1?(hasMsg=!1,displayNewWordSet(),$("#game-board .unfinished").children().show(),msgList=[],msgOffset=0):(msgOffset++,displayMessage())})}}
function runTimer(){switch(level){case 1:timeLeft=20;break;case 2:timeLeft=19;break;case 3:timeLeft=18;break;case 4:timeLeft=17;break;case 5:timeLeft=16;break;case 6:timeLeft=15;break;case 7:timeLeft=14;break;case 8:timeLeft=13;break;case 9:timeLeft=12;break;default:timeLeft=10}$("#game-board .time.number").text(timeLeft);intervalID=setInterval("decreaseTimeLeft()",1E3)}
function decreaseTimeLeft(){!gameOver&&!hasMsg&&(timeLeft--,$("#game-board .time.number").text(timeLeft),0==timeLeft&&(clearInterval(intervalID),frozenWordSet(),displayNewWordSet()))}function increaseScore(){playSound(audioSrc+"ding.mp3");var a=10*level;score+=a;$("#game-board .score.text").children(".plus-mark").hide().text("+ "+a).fadeIn(500).fadeOut(500)}function rebuildResult(){$("#game-board .level.number").text(level);$("#game-board .score.number").text(score)}
function frozenWordSet(a){a?(a.parent().parent().removeClass("unfinished").addClass("finished"),a.addClass("selected"),a.unbind("click").siblings(".unselected").unbind("click")):($("#game-board .unfinished .unselected").unbind("click"),$("#game-board .unfinished .unselected").each(function(){return compareTwoString($(this).attr("data-value"),htmlEncode(key))?($(this).addClass("selected"),!1):!0}),$("#game-board .unfinished").removeClass("unfinished").addClass("finished"));correctTimes=0;wrongTimes++;
6==wrongTimes?(gameOver=!0,endGame(),clearInterval(intervalID)):displayNewWordSet()}function playAgain(){$("#btn-load-result").parent().hide();$("#game-over").fadeOut(1E3,function(){$("#main-scene").fadeIn(1E3,function(){displayNewWordSet();resetMarks()});$("#btn-endgame").parent().show();$("#game-board").children(".result-board").siblings().remove()});resetMarks()}function resetMarks(){level=1;totalCorrect=wrongTimes=correctTimes=score=0;gameOver=!1;startTime=(new Date).getTime()}
function endGame(){playSound(audioSrc+"gameover.mp3");$("#btn-endgame").parent().stop(!0,!0).fadeOut(1E3);$("#main-scene").fadeOut(1E3,function(){$("#game-over .score .number").text(score);$("#game-over .level .number").text(level);$("#game-over .time .number").text(secondsToHms(((new Date).getTime()-startTime)/1E3));$("#game-over").fadeIn(1E3);$("#game-over").after($("#btn-load-result").parent().show())})}
function secondsToHms(a){var a=Number(a),c=Math.floor(a/3600),b=Math.floor(a%3600/60),a=Math.floor(a%3600%60);return(0<c?c+".":"00.")+(9<b?(0<c&&10>b?"0":"")+b+".":0>b?"00.":"0"+b+".")+(10>a?"0":"")+a}function addPlusMark(){score+=20*correctTimes}
function getWordSet(a){for(var c=[],a=4>a?3:3<a&&7>a?4:6<a&&10>a?5:6,b=randomFromTo(0,words.length-1),d=randomFromTo(0,words[b].length-1),e;!(e=randomFromTo(0,words[b].length-1),e!=d););d=words[b][d][randomFromTo(0,words[b][d].length-1)];c.push(d);for(var d=words[b][e].length,f=[],g=0;g<d;g++)f.push(words[b][e][g]);shuffle(f);return c.concat(f.slice(0,a-1))}
function initData(){for(var a=[],c=0;c<groups.length;c++){for(var b=groups[c].content.split("||"),d=[],e=0;e<b.length;e++){for(var f=b[e].split(","),g=[],h=0;h<f.length;h++)g.push($.trim(f[h]));d.push(g)}a.push(d)}return a};