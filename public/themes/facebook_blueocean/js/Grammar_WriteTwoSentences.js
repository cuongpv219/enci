$(document).ready(function(){function n(){var a='<ul class="sentences">',b='<ul class="sentences">';for(i=0;i<k;i++)0==i%2?a+='<li class="sentence"><span class="order-char">'+(i+1)+". </span>"+activityContent.group[i].sentence+'<span class="true-false-icon"></span><div class="textbox"><div class="textbox-wrap"><textarea class="text" type="text" tabindex="'+(2*i+1)+'"></textarea><div class="diff-container"></div></div>\n<div class="textbox-wrap"><textarea class="text" type="text" tabindex="'+(2*i+
2)+'"></textarea><div class="diff-container"></div></div></div></li> ':b+='<li class="sentence"><span class="order-char">'+(i+1)+". </span>"+activityContent.group[i].sentence+'<span class="true-false-icon"></span><div class="textbox"><div class="textbox-wrap"><textarea class="text" type="text" tabindex="'+(2*i+1)+'"></textarea><div class="diff-container"></div></div>\n<div class="textbox-wrap"><textarea class="text" type="text" tabindex="'+(2*i+2)+'"></textarea><div class="diff-container"></div></div></div></li> ';
a+="</ul>";b+="</ul>";$("#left-sentence-list").append($(a));$("#right-sentence-list").append($(b));$(".text:first").focus()}var k=activityContent.group.length,d=0,l=!0,m=!1;n();$("#loadResult").click(function(){l&&(l=!1,playSound(Ucan.Resource.Audio.getShowResultSound()),d=0,$(".text").each(function(){for(var a=Math.floor(($(this).attr("tabindex")-1)/2),b=($(this).attr("tabindex")-1)%2,c=[],c=0==b?activityContent.group[a].result1.split("/"):activityContent.group[a].result2.split("/"),d=!1,f=0,g=0,
h=null!=$(this).val()?$(this).val():"",e=0;e<c.length;e++){var j=htmlEncode(c[e]);if(j.toLowerCase().replace(/[^A-z0-9']/g," ").replace(/ +/g," ").replace(/^\s+|\s+$/g,"")==h.toLowerCase().replace(/[^A-z0-9']/g," ").replace(/ +/g," ").replace(/^\s+|\s+$/g,"")){d=!0;g=0;f=e;break}else 0==e?(f=0,g=getNumOfDiff(j,h)):g>getNumOfDiff(j,h)&&(f=e,g=getNumOfDiff(j,h))}d?(c='<span class="result" style="display: none; "> '+c[f]+"</span>",$(this).after(c)):(c='<span class="result"> '+c[f]+"</span>",$(this).next().append('<span id="showdiff'+
a+"_"+b+'" index='+a+" order="+b+' class ="showdiff">&nbsp&nbspDifference&nbsp&nbsp</span> '),$(this).after(c),$("#showdiff"+a+"_"+b).click(function(){if($(this).parent().children().hasClass("difference"))$(this).parent().children(".difference").remove();else{var a=$(this).parent().parent().children(".result").text(),a='<span class="difference">'+getCompareSentence(a,$(this).parent().parent().children(".text").val())+"</span>";$(this).after(a);0!=$(this).parent().children(".difference").children("add").length&&
0!=$(this).parent().children(".difference").children("rem").length?($(this).parent().children(".difference").children("add").css({color:"#fff","font-size":"0px"}),$(this).parent().children(".difference").children("rem").css({color:"#000","text-decoration":""}),$(this).parent().children(".difference").children("rem").animate({color:"#808080",opacity:"0.3"},1E3,function(){$(this).css({"text-decoration":"line-through"});$(this).parent().children("add").animate({color:"#FF0000","font-size":"14px"},500)})):
0!=$(this).parent().children(".difference").children("add").length?($(this).parent().children(".difference").children("add").css({color:"#fff","font-size":"0px"}),$(this).parent().children(".difference").children("add").animate({color:"#FF0000","font-size":"14px"},500)):0!=$(this).parent().children(".difference").children("add").length&&($(this).parent().children(".difference").children("rem").css({color:"#000","text-decoration":""}),$(this).parent().children(".difference").children("rem").animate({color:"#808080",
opacity:"0.3"},1E3,function(){$(this).css({"text-decoration":"line-through"})}))}}))}),$(".textbox").each(function(){0==$(this).children(".textbox-wrap").children(".diff-container").children(".showdiff").length?(d++,insertTrueFalseIcon(!0,$(this).parent().children(".true-false-icon"))):insertTrueFalseIcon(!1,$(this).parent().children(".true-false-icon"))}),$(".true-icon, .false-icon").ucanAnimateTrueFalseIcon(),$("#num-of-correct-answers-result").text(d+"/"+k),score=Math.floor(100*(d/k)),$("#score-text").text(score),
$("#show-result").show("slide",{direction:"left"},Ucan.Constants.getShowResultSpeed()),m=!0)});$("#redo").click(function(){m&&(m=!1,$("#show-result").hide("slide",{direction:"left"},Ucan.Constants.getHideResultSpeed(),function(){l=!0;$("#left-sentence-list").html("");$("#right-sentence-list").html("");n()}))});$("#show-answer").click(function(){$(".result").css({display:""}).animate({opacity:"0.3"},500,function(){$(this).animate({opacity:"1"},500)})})});