$(document).ready(function(){function n(){$(".audio-container").hide();$(".text").hide()}function o(a){b=a;$("#audio-container-"+a).show();$("#text-"+a).show().focus();$("#dialog-audio-"+a).jPlayer("play")}function h(a){return activityContent.group[a].sentence.replace(/[^A-z0-9',.;:!]/g," ").replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").split(" ")}function p(){$("#result-panel").text(i+"/"+e)}function q(a){a?$("#correct-text-"+b).append('<span class="enter-text">'+d[c]+"</span>"):$("#correct-text-"+
b).append('<span class="hint-text">'+d[c]+"</span>");$("#text-"+b).val("").focus();c<d.length-1?c++:b<g-1?(c=0,b++,d=h(b),a=b,n(),o(a)):(c++,$("#text-"+b).hide(),j=!1)}function r(){b=0;for(var a="",f=0;f<g;f++)a+='<div class="sentence-row"><div class="order-char">'+(f+1)+'</div><div id="sentence-wrap-'+f+'" class="sentence-wrap"><div class="correct-text" id="correct-text-'+f+'"></div><input type="text" class="text" id="text-'+f+'"/></div></div>';$("#paragraph-wrapper").append(a);$(".sentence-row").last().addClass("last-row");
n();o("0");d=h(0);c=0;$(".text").keyup(function(a){0==d[c].toLowerCase().indexOf($(this).val().toLowerCase())?$(this).css("color","black"):$(this).css("color","red");if(a=13==a.which||32==a.which)var a=$(this).val(),b=d[c],a=a.toLowerCase().replace(/[^A-z0-9']/g,"")==b.toLowerCase().replace(/[^A-z0-9']/g,"");a&&(q(!0),i++,p())});p()}$("#show-word-button").click(function(){j&&q(!1)});for(var g=activityContent.group.length,e=0,l=0;l<g;l++)e+=h(l).length;var j=!0,i=0,b=0,d=[],c=0,m=!1;r();$(".cp-jplayer").bind($.jPlayer.event.ended,
function(){$("#text-"+b).focus()});var k=0;$("#loadResult").click(function(){playSound(Ucan.Resource.Audio.getShowResultSound());j=!1;$(".text").hide();k=i;$("#num-of-correct-answers-result").text(k+"/"+e);score=Math.floor(100*(k/e));$("#score-text").text(score);$("#show-result").show("slide",{direction:"left"},Ucan.Constants.getShowResultSpeed());m=!0});$("#redo").click(function(){m&&(m=!1,$("#show-result").hide("slide",{direction:"left"},Ucan.Constants.getHideResultSpeed(),function(){k=c=b=i=0;
j=!0;$("#paragraph-wrapper").html("");r()}))});$("#show-answer").click(function(){for(var a=c;a<d.length;a++)$("#correct-text-"+b).append('<span class="hint-text">'+d[a]+"</span>");c=d.length;for(a=parseInt(b)+1;a<g;a++)for(var f=h(a),e=0;e<f.length;e++)$("#correct-text-"+a).append('<span class="hint-text">'+f[e]+"</span>");b=g-1;$(".correct-text").fadeOut(500).fadeIn(500)})});