$(document).ready(function(){function o(){var a="";c=shuffle(c);for(var b=0;b<f;b++){a+='<div class="sentence-row"><div class="character-order">'+(b+1)+'</div><div class="sentence-word-wrap"><div class="sentence-wrap" id="sentence-wrap_'+b+'">';for(j=0;j<c[b].wordArr.length;j++)a+='<div class="space" row="'+b+'" col="'+j+'"> </div><span class="text">'+c[b].wordArr[j]+"</span>";a+='<div class="space last-space" row="'+b+'" col="'+c[b].wordArr.length+'"> </div></div><div class="select-word-wrap" row="'+
b+'">';for(k=0;k<c[b].answerArr.length;k++)a+='<span class="select-word not-chosen" row="'+b+'" col="'+k+'" id="select_word_'+b+"_"+k+'">'+c[b].answerArr[k]+"</span>";a+='<div class="clearBoth"></div></div></div></div><div class="clearBoth"></div>'}$("#sentences-container").append(a);$('.space[col="0"]').addClass("first-space");$(".select-word").draggable({revert:"invalid",helper:"clone",start:function(b,a){a.helper.css({height:"10px","background-color":"transparent",color:"#a51c30",padding:"5px 0px 0px 0px"});
$(this).data("draggable").offset.click.top=15;$(this).data("draggable").offset.click.left=a.helper.width()/2}});$(".space,.text").droppable({accept:".select-word,.chosen-word",over:p,out:q,drop:r});$(".select-word-wrap").droppable({accept:".chosen-word",drop:function(b,a){if($(this).attr("row")==a.draggable.attr("row")){playSound(Ucan.Resource.Audio.getClickedSound());$("#select_word_"+a.draggable.attr("row")+"_"+a.draggable.attr("col")).switchClass("chosen","not-chosen").draggable("enable");var c=
a.draggable.next();a.draggable.remove();$(c).remove()}}})}function p(a,b){var c=$(this).hasClass("text")?$(this).next():$(this);$(c).attr("row")==b.draggable.attr("row")&&(playSound(Ucan.Resource.Audio.getClickedSound()),$(c).hasClass("last-space")||$(c).width(b.draggable.width()),$(c).css({border:"1px solid #ddd","background-color":"#f6f6f6"}))}function q(){var a=$(this).hasClass("text")?$(this).next():$(this);$(a).hasClass("last-space")||$(a).width(7);$(a).css({border:"","background-color":""})}
function r(a,b){if(g){var c=$(this).hasClass("text")?$(this).next():$(this);if($(c).attr("row")==b.draggable.attr("row")){playSound(Ucan.Resource.Audio.getClickedSound());var e=b.draggable.attr("row"),f=b.draggable.attr("col");$(c).width(7);$(c).css({border:"","background-color":""});if(b.draggable.hasClass("select-word"))b.draggable.switchClass("not-chosen","chosen").draggable("disable");else{var d=b.draggable.next();if(d.attr("id")==$(c).attr("id"))return;b.draggable.remove();$(d).remove()}d=$(c).parent().children(".text").length+
1;$(c).after('<span class="text chosen-word" row="'+e+'" col="'+f+'" id="chosen_word_'+e+"_"+f+'">'+b.draggable.text()+'</span><div class="space" row="'+$(c).attr("row")+'" col="'+d+'" id="space_'+e+"_"+d+'"></div>');$(".last-space").removeClass("last-space");$(".sentence-wrap div:last-child").addClass("last-space");$("#space_"+e+"_"+d).droppable({accept:".select-word,.chosen-word",over:p,out:q,drop:r});$("#chosen_word_"+b.draggable.attr("row")+"_"+b.draggable.attr("col")).draggable({revert:"invalid",
helper:"clone"})}}}function s(){for(i=0;i<f;i++)$("#sentence-wrap_"+i).html(c[i].stdString.replace(/[\[]/g,'<span class="chosen-word">').replace(/[\]]/g,"</span>")),$("#sentence-wrap_"+i).css({"word-spacing":"7px","padding-left":"32px"});$(".chosen-word").fadeOut(500).fadeIn(500)}var g=!0,l=!1,f=activityContent.group.length,c=[];for(m=0;m<f;m++){var t=c,u=m,d=activityContent.group[m].sentence.replace(/[.]/g," . ").replace(/[,]/g," , ").replace(/[:]/g," : ").replace(/[?]/g," ? ").replace(/[;]/g," ; ").replace(/ +/g,
" ").replace(/^\s+|\s+$/g,"").toLowerCase(),e=/\[([^\]])+\]/g,n=d.match(e),v=d.replace(e,"").replace(/ +/g," ").replace(/^\s+|\s+$/g,""),e={};e.stdString=d;e.wordArr=v.split(" ");d=[];for(i=0;i<n.length;i++)d[i]=n[i].substr(1,n[i].length-2);e.answerArr=d;t[u]=e}o();var h=0;$("#loadResult").click(function(){if(g){g=!1;playSound(Ucan.Resource.Audio.getShowResultSound());h=0;$(".ui-draggable").draggable("disable");for(i=0;i<f;i++){var a="";$("#sentence-wrap_"+i).children(".text").each(function(){a+=
$(this).hasClass("chosen-word")?"["+$(this).text()+"] ":$(this).text()+" "});a.substr(0,a.length-1)==c[i].stdString?(h++,insertTrueFalseIconAfter(!0,$("#sentence-wrap_"+i).parent())):insertTrueFalseIconAfter(!1,$("#sentence-wrap_"+i).parent())}$(".true-icon").css({"margin-top":"35px"});$(".false-icon").css({"margin-top":"35px"});$(".true-icon, .false-icon").ucanAnimateTrueFalseIcon();$("#num-of-correct-answers-result").text(h+"/"+f);score=Math.floor(100*(h/f));$("#score-text").text(score);$("#show-result").show("slide",
{direction:"left"},Ucan.Constants.getShowResultSpeed());l=!0}});$("#redo").click(function(){l&&(l=!1,$("#show-result").hide("slide",{direction:"left"},Ucan.Constants.getHideResultSpeed(),function(){g=!0;$("#sentences-container").html("");o()}))});$("#show-answer").click(function(){0<$(".chosen-word").length?$(".chosen-word").fadeOut(1E3,s):s()})});