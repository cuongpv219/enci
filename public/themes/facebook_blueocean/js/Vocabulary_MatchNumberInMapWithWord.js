$(document).ready(function(){function j(){for(var c="",d=activityContent.markSize,g=Math.round(4*d/5),e=shuffle(activityContent.group),a=0;a<f.length;a++)$("#word-container").append('<div class="group-word" id="group_'+a+'"><div class="group-title">'+f[a]+"</div></div>");for(a=0;a<k;a++){var j=e[a].position.split(":")[0],l=e[a].position.split(":")[1],h=$.inArray(e[a].mapGroup,f),c=c+('<div class="mark" style="width: '+d+"px; height: "+d+"px; font-size: "+g+"px; left: "+j+"px; top: "+l+"px; line-height: "+
g+'px; " data-group="'+h+'" id="mark-'+h+"-"+e[a].order+'">'+e[a].order+"</div>");$("#group_"+h).append('<div class="word-wrap" data-value="'+e[a].order+'" data-group="'+h+'"><div class="order order-unmatch" data-group="'+h+'"></div><div class="word-definition">'+e[a].definition.replace(/\[\[/g,'<span class="emphasis">').replace(/\]\]/g,"</span>")+"</div></div>")}$("#map-container").append(c);$(".mark").draggable({revert:"invalid",helper:"clone"});$(".order").draggable({revert:"invalid",helper:"clone"}).draggable("disable");
$(".word-wrap").droppable({accept:".mark, .order",over:function(a,b){$(this).attr("data-group")==b.draggable.attr("data-group")&&$(this).children(".order:first").text()!=b.draggable.text()&&(playSound(Ucan.Resource.Audio.getClickedSound()),$(this).children(".order").switchClass("order-unmatch order-match","order-over"))},out:function(a,b){$(this).attr("data-group")==b.draggable.attr("data-group")&&$(this).children(".order:first").text()!=b.draggable.text()&&(""!=$(this).children(".order").text()?
$(this).children(".order").switchClass("order-over","order-match"):$(this).children(".order").switchClass("order-over","order-unmatch"))},drop:function(a,b){if($(this).attr("data-group")==b.draggable.attr("data-group")&&$(this).children(".order:first").text()!=b.draggable.text()&&i)if(playSound(Ucan.Resource.Audio.getClickedSound()),"map-container"==b.draggable.parent().attr("id"))""!=$(this).children(".order").text()&&$("#mark-"+$(this).attr("data-group")+"-"+$(this).children(".order").text()).draggable("enable").animate({"background-color":"#fff"},
200).animate({"background-color":"#d80000"},200),$(this).switchClass("","highlight-word-wrap",500,function(){$(this).children(".order").text(b.draggable.text()).switchClass("order-over","order-match").draggable("enable");$(this).switchClass("highlight-word-wrap","",500)}),b.draggable.draggable("disable").animate({"background-color":"#fff"},200).animate({"background-color":"#6bae22"},200);else{var c=b.draggable.parent();$(this).children(".word-definition").before(b.draggable);$(c).children(".word-definition").before($(this).children(".order:first"));
""!=$(c).children(".order:first").text()?$(c).children(".order:first").switchClass("order-over","order-match"):$(c).children(".order:first").switchClass("order-over","order-unmatch");$(this).switchClass("","highlight-word-wrap",500,function(){$(this).switchClass("highlight-word-wrap","",500)});c.switchClass("","highlight-word-wrap",500,function(){$(this).switchClass("highlight-word-wrap","",500)})}}});$("#map-container").droppable({accept:".order",drop:function(a,b){i&&(playSound(Ucan.Resource.Audio.getClickedSound()),
$("#mark-"+b.draggable.attr("data-group")+"-"+b.draggable.text()).draggable("enable").animate({"background-color":"#fff"},200).animate({"background-color":"#d80000"},200),b.draggable.text("").draggable("disable").switchClass("order-match","order-unmatch"),b.draggable.parent().switchClass("","highlight-word-wrap",500,function(){$(this).switchClass("highlight-word-wrap","",500)}))}})}for(var i=!0,k=activityContent.group.length,f=[],g=!1,c=0;c<k;c++)-1==$.inArray($.trim(activityContent.group[c].mapGroup),
f)&&(f[f.length]=$.trim(activityContent.group[c].mapGroup));j();$("#show-answer").click(function(){$(".order").each(function(){$(this).text($(this).parent().attr("data-value")).switchClass("order-unmatch","order-match").fadeOut(200).fadeIn(200)})});var d=0;$("#loadResult").click(function(){i&&(i=!1,$(".ui-draggable").draggable("disable"),playSound(Ucan.Resource.Audio.getShowResultSound()),d=0,$(".order").each(function(){$(this).parent().attr("data-value")==$(this).text()?(d++,insertTrueFalseIconAfter(!0,
$(this).next())):insertTrueFalseIconAfter(!1,$(this).next())}),$(".true-icon, .false-icon").ucanAnimateTrueFalseIcon(),$("#num-of-correct-answers-result").text(d+"/"+k),score=Math.floor(100*(d/k)),$("#score-text").text(score),$("#show-result").show("slide",{direction:"left"},Ucan.Constants.getShowResultSpeed()),g=!0)});$("#redo").click(function(){g&&(g=!1,$("#show-result").hide("slide",{direction:"left"},Ucan.Constants.getHideResultSpeed(),function(){i=!0;$("#map-container").children(".mark").remove();
$("#word-container").html("");j()}))})});